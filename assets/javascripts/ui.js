function jq(e){return e.replace(/(:|\.|\[|\]|,)/g,"\\$1")}function anchorScroll(e){e="string"==typeof e?e:$(this).attr("href");var t=60;if(0==e.indexOf("#")){var n=$(e);if(n.length&&($("html, body").animate({scrollTop:n.offset().top-t}),history&&"pushState"in history))return history.pushState({},document.title,window.location.pathname+e),!1}}function citationDate(){var e=moment().format("D MMM. YYYY");$(".cite-current-date").empty(),$(".cite-current-date").text(e)}function footnoteScroll(){$(".footnote, .reversefootnote, .section-link").click(function(){var e=$(this).attr("href"),t=$(jq(e)).offset().top;$("html, body").animate({scrollTop:t-70},250)})}function keyboardNav(){$(document).keydown(function(e){var t,n,i;t=document.getElementById("prev-link"),n=document.getElementById("next-link"),i=$(".pswp").hasClass("pswp--visible"),i||(37===e.which&&t?(t.click(),e.preventDefault()):39===e.which&&n&&(n.click(),e.preventDefault()))})}function offCanvasNav(){var e=$(".nav-sidebar"),t=$("#navbar-menu"),n=$("#nav-menu-close"),i=$(".sliding-panel-fade-screen");t.on("click",function(){e.toggleClass("visible"),i.toggleClass("visible"),$("<style></style>").appendTo($(document.body)).remove()}),n.on("click",function(){e.removeClass("visible"),i.removeClass("visible")}),i.on("click",function(){e.removeClass("visible"),i.removeClass("visible")}),$(document).keydown(function(t){27===t.which&&e.hasClass("visible")&&(e.removeClass("visible"),i.removeClass("visible"))})}function expanderSetup(){var e=$(".expander-content"),t=$(".expander-trigger");$(e).addClass("expander--hidden"),t.on("click",function(){var e=$(this).parent().find(".expander-content");e.slideToggle("fast",function(){e.toggleClass("expander--hidden")})})}function lightBoxSetup(){$(".gallery-slide")&&($figures=$(".gallery-slide img"),$figures.on("click",function(e){var t=document.querySelectorAll(".gallery-slide"),n=_.findIndex(t,function(t){return t.id==e.target.parentNode.id});console.log(n),lightBox(n)}))}function stickySetup(){$(".page-sidebar-inner").stick_in_parent({offset_top:70})}function sidebarSetup(){$(".section-nav")&&$(".section-heading").each(function(e,t){var n=document.createElement("li"),i=document.createElement("a"),o=document.createTextNode(t.innerHTML),a="#"+t.id;i.setAttribute("href",a),i.setAttribute("class","section-link"),i.appendChild(o),n.appendChild(i),$(".section-nav").append(n)})}function popupSetup(){var e=$(".popup");e.each(function(){var e=$(this);if(e.data("definition")){var t=$("<div>",{"class":"popup-content"});t.html(e.data("definition")),e.append(t),e.on("click",function(){e.find(".popup-content").toggleClass("visible")})}else if(e.data("location")){var n;if(n=_.find(geojsonFeature.features,function(t){return t.properties.id==e.data("location")}),void 0==n)console.log("No location data for "+e.text()),e.removeClass("popup popup-location");else{var t,i,o,a;t=$("<div>",{"class":"popup-content"}),e.append(t),o=L.latLng([n.geometry.coordinates[1],n.geometry.coordinates[0]]),i=new PopupMap(o,e.find(".popup-content")[0]).map,a=L.marker(o).addTo(i),a.bindPopup(n.properties.custom_name),e.on("click",function(){e.find(".popup-content").hasClass("visible")||(i.setView(o,6),e.find(".popup-content").addClass("visible"),window.setTimeout(function(){i.invalidateSize()},300))})}}else if(e.data("pic")){var s=JSON.parse(e.data("pic")),t=$("<figure>",{"class":"popup-content"}),c=$("<img>",{src:"/publications/romanmosaics/assets/images/pics/"+s.file}),l=$("<figcaption>");l.html("<a href='"+s.url+"' target='blank'>"+s.title+"</a>. "+s.source_credit),t.append(c),t.append(l),e.append(t),e.on("click",function(){e.find(".popup-content").toggleClass("visible")})}})}function uiSetup(){sidebarSetup(),keyboardNav(),offCanvasNav(),popupSetup(),expanderSetup(),lightBoxSetup(),footnoteScroll(),anchorScroll(window.location.hash),citationDate(),stickySetup()}